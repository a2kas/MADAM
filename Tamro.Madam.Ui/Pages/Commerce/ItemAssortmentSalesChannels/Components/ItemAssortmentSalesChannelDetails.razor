@using Tamro.Madam.Models.Commerce.ItemAssortmentSalesChannels

<MudGrid Class="d-flex">
    <MudItem sm="4" md="6" xs="12" Class="d-flex align-items-center">
        <MudIcon Icon="@Icons.Material.Filled.LocalOffer" Color="Color.Tertiary" Size="Size.Large" />
        <MudText Class="gap-4 ma-1" Typo="Typo.h6">@(_state.Value.Model.Id == default ? "Create new item": "Item") assortment sales channel</MudText>
    </MudItem>

    <MudItem sm="8" md="6" xs="12" Class="d-flex align-items-end justify-end button-bar">
        <MudButton StartIcon="@Icons.Material.Filled.Cancel" OnClick="OnClose">Close</MudButton>
        <MudLoadingButton Disabled="!_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)" StartIcon="@Icons.Material.Filled.Save" Variant="Variant.Filled" Loading="@_saving" OnClick="Submit" Color="Color.Primary">Save</MudLoadingButton>
    </MudItem>
</MudGrid>

<MudForm _state.Value.Model="@_state.Value.Model" @ref="@_form" Validation="@(_validator.ValidateValue(_state.Value.Model))">
    <MudGrid Class="d-flex pt-3 pb-3">
        <MudItem xs="12" md="8" lg="6">
            <MudTextField Label="@DisplayNameHelper.Get(() => _state.Value.Model.Name)" @bind-Value="_state.Value.Model.Name"
                Immediate="true"
                Disabled="!_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)"
                Variant="Variant.Outlined"
                FullWidth="true"
                For="@(() => _state.Value.Model.Name)"
                Required="true">
            </MudTextField>
        </MudItem>
    </MudGrid>
    <MudGrid Class="d-flex">
        <MudItem sm="2" xs="12" Class="d-flex align-items-center">
            <MudIcon Icon="@Icons.Material.Filled.MedicationLiquid" Color="Color.Tertiary" Size="Size.Medium" />
            <MudText Class="gap-4 ma-1" Typo="Typo.button">Assortment</MudText>
        </MudItem>

        <MudItem sm="10" xs="12" Class="d-flex align-items-end justify-end button-bar">
            <MudButton Variant="Variant.Outlined"
                       Size="Size.Small"
                       StartIcon="@Icons.Material.Filled.Refresh" IconColor="Color.Surface" Color="Color.Primary"
                       OnClick="OnResetAssortmentGrid"
                       Style="margin-right: 4px; margin-bottom:4px">
                Reset
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.FileUpload"
                       Size="Size.Small"
                       Style="margin-right: 4px; margin-bottom:4px"
                       Disabled="!_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)"
                       OnClick="OnImportAssortment"
                       IconColor="Color.Surface">
                Import
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Error"
                       StartIcon="@Icons.Material.Filled.Delete"
                       Size="Size.Small"
                       Disabled="_selectedAssortment.Count < 1 || !_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)"
                       Style="margin-right: 4px; margin-bottom:4px"
                       OnClick="OnDeleteAssortment"
                       IconColor="Color.Surface">
                Delete
            </MudButton>
            <MudLoadingButton Variant="Variant.Outlined" Color="Color.Primary"
                              Label="Export"
                              StartIcon="@Icons.Custom.FileFormats.FileExcel"
                              Size="Size.Small"
                              Style="margin-right: 4px; margin-bottom:4px"
                              OnClick="OnExportAssortment"
                              IconColor="Color.Surface">
                Export
            </MudLoadingButton>
        </MudItem>
    </MudGrid>
    <MudDataGrid T="ItemAssortmentGridModel" Items="@_state.Value.Model.Assortment"
                    Virtualize="false"
                    @bind-RowsPerPage="_defaultPageSize"
                    Striped="true"
                    Bordered="true"
                    Dense="true"
                    ColumnResizeMode="ResizeMode.Column"
                    DragDropColumnReordering="true"                  
                    ApplyDropClassesOnDragStarted="true"
                    FilterMode="@DataGridFilterMode.ColumnFilterRow"
                    Filterable="true"
                    MultiSelection="true"
                    SortMode="SortMode.Single"
                    @bind-SelectedItems="_selectedAssortment"
                    Hideable="true"
                    Hover="true"
                    @ref="_assortmentGrid">
        <Columns>
            <SelectColumn Size="Size.Small" T="ItemAssortmentGridModel" ShowInFooter="false"></SelectColumn>
            <TemplateColumn CellStyle="width: 50px" Title="Actions" Filterable="false" Sortable="false">
                <CellTemplate>
                    <MudGrid Class="action-bar">
                        <MudItem>
                            <MudTooltip Text="Delete" Placement="Placement.Top">
                                <MudIconButton DisableElevation
                                               Icon="@Icons.Material.Filled.Delete"
                                               Size="Size.Small"
                                               OnClick="@(() => OnDeleteSingleAssortment(context.Item))"
                                               Disabled="!_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)">
                                </MudIconButton>
                            </MudTooltip>
                        </MudItem>
                    </MudGrid>
                </CellTemplate>
            </TemplateColumn>
            <PropertyColumn Property="x => x.ItemCode" Title="@DisplayNameHelper.Get(typeof(ItemAssortmentGridModel), nameof(ItemAssortmentGridModel.ItemCode))"></PropertyColumn>
            <PropertyColumn InitialDirection="SortDirection.Ascending" Property="x => x.ItemName" Title="@DisplayNameHelper.Get(typeof(ItemAssortmentGridModel), nameof(ItemAssortmentGridModel.ItemName))"></PropertyColumn>
        </Columns>
        <NoRecordsContent>
            <MudText>No data to display</MudText>
        </NoRecordsContent>
        <LoadingContent>
            <MudText>Loading</MudText>
        </LoadingContent>
        <PagerContent>
            <MudDataGridPager PageSizeOptions="@(new[] { 10, 15, 30, 50, 100, 200 })" />
        </PagerContent>
    </MudDataGrid>

    <MudGrid Class="d-flex pt-8">
        <MudItem xs="12" Class="d-flex align-items-end justify-end button-bar">
            <MudButton StartIcon="@Icons.Material.Filled.Cancel" OnClick="OnClose">Close</MudButton>
            <MudLoadingButton Disabled="!_userProfileState.Value.HasPermission(Permissions.CanManageItemAssortmentSalesChannels)" StartIcon="@Icons.Material.Filled.Save" Variant="Variant.Filled" Loading="@_saving" OnClick="Submit" Color="Color.Primary">Save</MudLoadingButton>
        </MudItem>
    </MudGrid>
</MudForm>