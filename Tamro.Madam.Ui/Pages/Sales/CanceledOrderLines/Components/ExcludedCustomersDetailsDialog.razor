@using Tamro.Madam.Models
@using Tamro.Madam.Models.Customers.Wholesale.Clsf
<MudDialog xs="6" DefaultFocus="DefaultFocus.None">
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@Icons.Material.Filled.PlaylistRemove" Class="mr-3 mb-n1" />
            Exclude customer
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudForm Model="@_model" @ref="@_form" onkeydown="@OnKeyDown" Validation="@(_validator.ValidateValue(_model))">
            <MudGrid>
                <MudItem xs="12">
                    <MudAutocomplete Label="@DisplayNameHelper.Get(() => _model.Customer)"
                                     T="WholesaleCustomerClsfModel"
                                     Required
                                     MaxItems="20"
                                     ResetValueOnEmptyText
                                     Immediate
                                     Clearable
                                     Margin="Margin.Dense"
                                     Dense
                                     DebounceInterval="200"
                                     SearchFunc="@SearchCustomers"
                                     ToStringFunc="@(e => e == null ? null : e.DisplayName)"
                                     For="@(() => _model.Customer)"
                                     ProgressIndicatorColor="Color.Primary"
                                     @bind-Value="_model.Customer"
                                     Variant="Variant.Outlined"
                                     ShowProgressIndicator="true">
                    </MudAutocomplete>
                </MudItem>

                <MudItem xs="12" Class="mt-4">
                    <MudText Typo="Typo.subtitle2" Class="mb-2">Exclude</MudText>
                    <MudRadioGroup T="ExclusionLevel" @bind-SelectedOption="_model.ExclusionType">
                        <MudRadio T="ExclusionLevel" Option="@ExclusionLevel.EntireLegalEntity" Color="Color.Primary" Dense="true">
                            <MudText>Entire legal entity</MudText>
                        </MudRadio>
                        <MudRadio T="ExclusionLevel" Option="@ExclusionLevel.OneOrMorePhysicalLocations" Color="Color.Primary" Dense="true">
                            <MudText>One or more physical locations</MudText>
                        </MudRadio>
                    </MudRadioGroup>
                </MudItem>

                @if (_model.ExclusionType == ExclusionLevel.OneOrMorePhysicalLocations && _model.Customer != null)
                {
                    <MudItem xs="12" Class="mt-4">
                        <MudDataGrid T="CustomerLocationModel"
                                     Items="@_customerLocations"
                                     Dense="true"
                                     Hover="true"
                                     Bordered="true"
                                     Striped="true"
                                     FixedHeader="true"
                                     Height="300px">
                            <Columns>
                                <PropertyColumn Property="x => x.ShipToCode" Title="Ship to" />
                                <PropertyColumn Property="x => x.Name" Title="Name" />
                                <TemplateColumn Title="Is excluded" CellClass="d-flex justify-center">
                                    <CellTemplate>
                                        <MudCheckBox @bind-Checked="@context.Item.IsExcluded"
                                                     Color="Color.Primary"
                                                     Dense="true" />
                                    </CellTemplate>
                                </TemplateColumn>
                            </Columns>
                        </MudDataGrid>
                    </MudItem>
                }
            </MudGrid>
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton StartIcon="@Icons.Material.Filled.Cancel" OnClick="Cancel">Cancel</MudButton>
        <MudLoadingButton StartIcon="@Icons.Material.Filled.Save" Variant="Variant.Filled" Color="Color.Primary" Loading="@_saving" OnClick="Submit">Save</MudLoadingButton>
    </DialogActions>
</MudDialog>